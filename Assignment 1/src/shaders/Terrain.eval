#version 400

layout(quads, equal_spacing, ccw) in;


uniform mat4 mvpMatrix;
uniform sampler2D heightMap;
uniform float water_level;
uniform float snow_level;

out vec2 texCoord;

void main()
{
    float xmin = -45, xmax = +45, zmin = 0, zmax = -100;
    vec4 posn;
    float s, t;

    float u = gl_TessCoord.x;
    float v = gl_TessCoord.y;

    posn = (1-u) * (1-v) * gl_in[0].gl_Position
         +    u  * (1-v) * gl_in[1].gl_Position
         +    u  *    v  * gl_in[2].gl_Position
         + (1-u) *    v  * gl_in[3].gl_Position;    

    s = ((posn.x) - xmin) / (xmax - xmin);
    t = ((posn.z) - zmin) / (zmax - zmin);

    texCoord = vec2(s, t);
    
    float height = texture(heightMap, texCoord).r;
    posn.y = height * 10.0;  // Scale

    if (posn.y < water_level) 
        posn.y = water_level;
    

    gl_Position = mvpMatrix * posn;
}
